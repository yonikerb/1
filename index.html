<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>קורסים קרובים - יוז'וק מדיק</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #e0f7fa, #ffffff);
      direction: rtl;
    }
    /* ... CSS כמו קודם ... */
  </style>
</head>
<body>
  <h1>קורסים קרובים ביוז'וק מדיק</h1>
  <div id="courses"></div>

  <script>
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbyM2RL13HRo5IauHmhapLLgV4kCPVRmGHg7Ax2ApEstyo-zx4u19XmNl8414pTeBgtIKw/exec";

    fetch(SHEET_URL)
      .then(res => res.json())
      .then(data => {
        console.log("DATA FROM API:", data); // הדפסת הנתונים לקונסול
        const container = document.getElementById('courses');

        if (!data || data.length === 0) {
          container.innerHTML = "<p style='text-align:center;'>אין כרגע קורסים זמינים.</p>";
          return;
        }

        // אם data הוא מערך של אובייקטים
        if(typeof data[0] === "object" && !Array.isArray(data[0])) {
          data.forEach(course => {
            console.log("Course object:", course);
            // כאן השתמש בשמות העמודות לפי שדות האובייקט
            const banner = document.createElement('div');
            banner.className = 'banner';

            const imgSrc = extractDriveImage(course["העלאת תמונה"]);

            const startDate = formatDate(course["תאריך התחלה"]);
            const endDate = formatDate(course["תאריך סיום הקורס"]);
            const days = course["ימי מפגשים"] || '';
            const hours = course["שעות"] || '';
            const price = course["מחיר"] || '';
            const audience = course["קהל יעד"] || '';
            const notes = course["הערות"] || '';
            const level = course["הכשרה"] || '';
            const location = course["מיקום"] || '';

            banner.innerHTML = `
              <img src="${imgSrc}" alt="תמונה" />
              <div class="banner-content">
                <h2>${level}</h2>
                <p><strong>תאריך התחלה:</strong> ${startDate}</p>
                <p><strong>תאריך סיום:</strong> ${endDate}</p>
                <p><strong>ימי מפגשים:</strong> ${days}</p>
                <p><strong>שעות:</strong> ${hours}</p>
                <p><strong>מחיר:</strong> ${price} ש"ח</p>
                <p><strong>קהל יעד:</strong> ${audience}</p>
                <p><strong>הערות:</strong> ${notes}</p>
                <p><strong>מיקום:</strong> ${location}</p>
                <a href="#" class="register-btn">להרשמה</a>
              </div>
            `;
            container.appendChild(banner);
          });
        }
        // אם data הוא מערך של מערכים
        else if(Array.isArray(data[0])) {
          data.forEach(row => {
            console.log("Course array row:", row);
            const banner = document.createElement('div');
            banner.className = 'banner';

            const imgSrc = extractDriveImage(row[9]);
            const startDate = formatDate(row[1]);
            const endDate = formatDate(row[2]);
            const days = row[3] || '';
            const hours = row[4] || '';
            const price = row[5] || '';
            const audience = row[6] || '';
            const notes = row[7] || '';
            const level = row[8] || '';
            const location = row[10] || '';

            banner.innerHTML = `
              <img src="${imgSrc}" alt="תמונה" />
              <div class="banner-content">
                <h2>${level}</h2>
                <p><strong>תאריך התחלה:</strong> ${startDate}</p>
                <p><strong>תאריך סיום:</strong> ${endDate}</p>
                <p><strong>ימי מפגשים:</strong> ${days}</p>
                <p><strong>שעות:</strong> ${hours}</p>
                <p><strong>מחיר:</strong> ${price} ש"ח</p>
                <p><strong>קהל יעד:</strong> ${audience}</p>
                <p><strong>הערות:</strong> ${notes}</p>
                <p><strong>מיקום:</strong> ${location}</p>
                <a href="#" class="register-btn">להרשמה</a>
              </div>
            `;
            container.appendChild(banner);
          });
        } else {
          container.innerHTML = "<p style='text-align:center;'>מבנה הנתונים לא נתמך.</p>";
        }
      })
      .catch(err => {
        console.error(err);
        document.getElementById('courses').innerHTML = "<p style='text-align:center;'>שגיאה בטעינת הקורסים.</p>";
      });

    function extractDriveImage(link) {
      if (!link) return "https://via.placeholder.com/340x200.png?text=אין+תמונה";
      const idMatch = link.match(/[-\w]{25,}/);
      if (idMatch) {
        return `https://drive.google.com/uc?export=view&id=${idMatch[0]}`;
      }
      return "https://via.placeholder.com/340x200.png?text=אין+תמונה";
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      if (!isNaN(date)) {
        return date.toLocaleDateString('he-IL');
      }
      const parts = dateStr.split('/');
      if (parts.length === 3) {
        return `${parts[0].padStart(2,'0')}/${parts[1].padStart(2,'0')}/${parts[2]}`;
      }
      return dateStr;
    }
  </script>
</body>
</html>
